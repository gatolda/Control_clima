<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ğŸŒ± Control ClimÃ¡tico</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>ğŸŒ± Dashboard de Control ClimÃ¡tico</h1>

        <div class="sensores">
            <h2>ğŸ“¡ Sensores</h2>
            <div id="sensor-data">
                <!-- Los datos se cargarÃ¡n aquÃ­ vÃ­a AJAX -->
                <p>Cargando lecturas...</p>
            </div>
        </div>

        <div class="actuadores">
            <h2>âš¡ Actuadores</h2>
            {% for nombre in actuator_manager.relay_pins.keys() %}
            <div class="actuador">
                <span>{{ nombre }}</span>
                <button onclick="controlActuador('{{ nombre }}', 'on')" class="btn-on">Encender</button>
                <button onclick="controlActuador('{{ nombre }}', 'off')" class="btn-off">Apagar</button>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        // Actualiza las lecturas cada 5 segundos
        function actualizarSensores() {
            fetch('/api/sensores')
                .then(response => response.json())
                .then(data => {
                    let html = "";
                    for (const [sensor, lectura] of Object.entries(data)) {
                        html += `<div class="sensor">
                                    <strong>${sensor}</strong>: 
                                    ğŸŒ¡ï¸ ${lectura.temperature ?? "N/A"}Â°C, 
                                    ğŸ’§ ${lectura.humidity ?? "N/A"}%
                                </div>`;
                    }
                    document.getElementById("sensor-data").innerHTML = html;
                })
                .catch(err => {
                    document.getElementById("sensor-data").innerHTML = "<p>âŒ Error al cargar datos</p>";
                });
        }

        function controlActuador(actuador, accion) {
            fetch(`/api/actuador/${actuador}/${accion}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                alert(`âœ… ${data.actuador} ${data.estado}`);
            });
        }

        setInterval(actualizarSensores, 5000);
        window.onload = actualizarSensores;
    </script>
</body>
</html>
